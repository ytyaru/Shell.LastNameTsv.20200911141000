# 重複排除アルゴリズム

　名字TSVファイルから重複しない名字だけをランダム出力するアルゴリズムを考える。

# 使用コマンド

```sh
DB=/home/pi/root/work/workflow/gtd/1_capture/pj/20200828_school/00_lastname/00_db/名字_2.tsv
cat "$DB" | shuf -n 1
cat "$DB" | awk -F "\t" '!a[$1]++' | wc -l
cat "$DB" | awk -F "\t" '!b[$2]++' | wc -l
cat "$DB" | awk -F "\t" '!a[$1]++ && !b[$2]++' | wc -l
```

# アルゴリズム

アルゴリズム|コマンド
------------|--------
読みが重複しない|`cat "$DB" | awk -F "\t" '!a[$1]++'`
表記が重複しない|`cat "$DB" | awk -F "\t" '!b[$2]++'`
読みと表記が重複しない|`cat "$DB" | awk -F "\t" '!a[$1]++ && !b[$2]++'`

　アルゴリズムは開発方針「簡略化を最優先する」に基づき、以下のようにした。

* 名字ランダム生成ツールとして有用であること
* 実装が簡単であること
* 実行が速いこと

　読みと表記の重複しない名前を網羅することは、名字ジェネレータとして有用であるために必要な最低限の機能である。よって上記３条件は必須。

　以下のようなアルゴリズムは除外した。

除外アルゴリズム|理由
----------------|----
異体字を除外する|異体字か否かの判断が難しい。DBが複雑化して開発と実行が遅れる。同じ読みを除外すれば類似したことができる。あとは目視判断。
異体字を一覧する|異体字か否かの判断が難しい。DBが複雑化して開発と実行が遅れる。同じ読みで抽出すれば類似したことができる。あとは目視判断。
韻数を指定する|読みから算出できるはず

# コマンド

　コマンドは大筋で以下のようなものになる。

```sh
cat "$DB" | awk -F "\t" "$COND_UNIQ" | shuf -n $NUM
```

1. `cat`でTSVファイルを出力する
2. `awk`で重複排除する
3. `shuf`でランダム出力する

# 引数

引数|内部変数|値|デフォルト値|概要
----|--------|--|------------|----
`n`|`NUM`|1以上の自然数|30|出力件数。
`u`|`COND_UNIQ`|`0`:デフォルト, `1`:なし `2`:読みが重複しない, `3`:表記が重複しない, `4`:読みと表記が重複しない|0|重複排除。

```
declare -x ARG_NUM ARG_COND_UNIQ
while getopts :d:p:c:f: OPT; do
    case $OPT in
        n) ARG_NUM="$OPTARG"; continue; ;;
        u) ARG_COND_UNIQ="$OPTARG"; continue; ;;
        \?) echo "-${OPTARG} は不正なオプションです。"; Usage; exit 1; ;;
    esac
done
ARG_NUM="${ARG_NUM:-30}"
ARG_COND_UNIQ="${ARG_COND_UNIQ:-4)}"

ARG_NUM=30
ARG_COND_UNIQ=4
```

# 対象環境

* <time datetime="2020-09-01T08:11:20+0900" title="実施日">2020-09-01</time>

