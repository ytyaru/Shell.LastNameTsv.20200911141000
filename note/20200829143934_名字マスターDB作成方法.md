# 名字マスターDB作成方法

1. ネットから日本における名字一覧CSVファイルなどを探す
2. 1のテキストデータを丸ごとコピーする
3. 2をTSV形式に整形する
4. 3をSQLite形式に整形する

# 情報源

* http://www.pachi.ac/~multi/cgi-bin/familyname/display.cgi?mode=aa
* http://www2s.biglobe.ne.jp/~suzakihp/index40.html

# 具体的な方法

1. 「http://www.pachi.ac/~multi/cgi-bin/familyname/display.cgi?mode=aa」をブラウザで開く
2. あかさたなはまやらわの各行にある名前をコピーする
3. テキストエディタにペーストする
4. 3をコピーする
5. 4を LibreOffice Calc にペーストする
6. 2〜5を全件繰り返す
7. 6をコピーする
8. 7をテキストエディタにペーストする
9. 8をTSVファイルとして保存する（`surname.tsv`）

# 気づいた不具合

* 一部、漢字が入力されていない（例：あおさき	（山の下に奇）」
* 異体字の名字が別の行で登録されている
* 異なる読みが登録されていない
* 異なる読みが別行で登録されている
* 異体字と異なる読みを含めて1行で登録するにはどのような形式で登録すべきか

# 登録すべき項目

* 必須
	* 漢字（表記）
	* 読み（ひらがな）
* 任意
	* 頻度（戸数）
	* 異体字パターン
	* 読みパターン
	* 画数

## フェーズ

1. 「http://www.pachi.ac/~multi/cgi-bin/familyname/display.cgi?mode=aa」からコピペしてTSVに整形する
2. 「（山の下に奇）」など漢字入力されていないものをできるだけ漢字入力する
	* 「http://www2s.biglobe.ne.jp/~suzakihp/index40.html」を参考にする
		* 1にない名前があれば任意で追記する
3. URLや空行など不要な行を削除する
4. 出現順序を優先度順にする
	* 同じ読みのうち代表表記を先頭にする
	* 同じ表記のうち代表読みを先頭にする
	* 「http://www2s.biglobe.ne.jp/~suzakihp/index40.html」の「世帯数」が多いものを最優先にする。それ以外は無保証。
		* 1にない名前があれば任意で追記する

## 不具合修正1：漢字入力

1. DBで漢字入力されていない箇所を抜き出す
2. 「http://www2s.biglobe.ne.jp/~suzakihp/index40.html」に名字の読みを入力して検索する
3. 出力された漢字をコピペする

　漢字入力されていない箇所は以下。

```
あおさき	（山の下に奇）
あおつか	青（土へんに冢）
あおやぎ	青（木へんに夘）
あかさき	赤（崎の大が立）
あかつか	赤（土へんに冢）
あきよし	秋（吉の士が土）
あべき	（木へんに青）木
あべまつ	（木へんに青）松
あべまつ	（木へんに青の月が円）松
あませ	天（瀬の頁が刀の下に貝）
あみさき	網（崎の大が立）
あめ	（餉の向が台）
あらたの	（余の下に田）野
ありたか	有（はしご高）
ありづか	蟻（土へんに冢）	塚
あんとく	安（徳の心の上に一）
いいずか	飯（土へんに冢）	塚
いいよし	飯（吉の士が土）	𠮷
いえづか	家（土へんに冢）	塚
いけざき	池（崎の大が立）	﨑
いざき	伊（崎の大が立）	﨑
いざき	井（崎の大が立）	﨑
いしさき	石（崎の大が立）
いしざき	石（崎の大が立）
いしづか	石（土へんに冢）	塚
いしづき	（折の下に心）
いしづき	（墫の土が金）
いずもり	（けものへんに犬）
いそざき	磯（崎の大が立）
いそざき	磯崎
いそざき	礒（崎の大が立）	﨑
いたか	位（はしご高）	髙
いちづか	市（土へんに冢）	塚
いづか	（土冠に猪）塚
いのり	（示へんに壽）
いのり	（祷の寿が壽）
いまだ	（今のラがテ）田
いまはら	（今のラがテ）原
いまよし	今（吉の士が土）𠮷
いれい	伊（ネへんに豊）
いわす	（山かんむりに品）栖
うかい	（鵜の弟が束）飼
うぐもり	（魚へんに鳥）森
うねむら	（田へんに人）村	㽗
えきだ	（澤のさんずいが山）𡵸
えびさわ	（魚へんに分）澤
おおかんだ	大（神のネが示）田
おおはま	大（濱の宀の下が眉に八）大濵
おせ	於（勢の左上が生）㔟
おとめ	乙（口へんに羊）	咩
おのせ	小野（瀬の頁が刀の下に貝）瀨
かくは	（角の田が甲）羽
かげした	（陰の人の下が長）下
かせだ	（悴の卒が九の下に十）忰田
かたざ	片㘴（坐の左上の人が口）
かみやなぎ	上栁（木へんに夘）
かわじり	川（尻の九が丸）	㞍
かわらさき	河原（先の大が立）﨑			※誤字と思われる。「先」でなく「崎」か。
きづか	木（塚の右が冢）塚				※表記ゆれ。「（土へんに冢）」と同じか。
きとく	亀（徳の心の上に一）德
くさなぎ	草（弓へんに剪）彅
くにぎだ	（木へんに解）
くろはばき	黒（脛のエの下に巾）
けんめい	（彳に建）徤名
こすぎ	小（木へんに久）杦
こたど	古田（土｀）𡈽
ことじ	（古の下に又）㕝子
さこだ	（土へんに谷）﨏田
さった	薩（土へんに垂）	埵
ざこうじ	（座の人が口と又）光寺			※「㘴」ならあるのだが……
ざま	（座の左の人が口）間					※「ざま	㘴間」が存在したことから「（座の左の人が口）」はやはり「㘴」にカンムリ付きの字か。
しみず	（清の月が円）水
しゅずい	守（随の有が左の下に月）隨
しらと	白（土、）圡
じょうたつ	（丈｀）達
すぎやま	（温のさんずいが木へん）榲山
すみ	（角の田が甲）
すみの	（角の田が甲）野
すみひろ	（角の田が甲）廣
すみや	（角の田が甲）谷
するこ	（木へんに字）𣑑子
そあい	（石へんに夾）硤合
そうけじま	（竹かんむりに皿）笽島
そにし	（口へんに曾）西
たかまつ	髙（松のムが口）
たかみざわ	（百貨店・高島屋の立）見澤
たかむら	（竹かんむりに屋）箼
たかむら	（竹冠に屋・一文字）
ちかまつ	近（松のムが口）
つのだ	（角の田が甲）田
つるい	（雨あめかんむりに鶴）靏井
つるい	（雨かんむりの左下に隹、右下に鳥）靍井
つるいけ	（雨かんむりに鶴）靏池
とぎや	（石へんに刑）硎屋
とどろき	（轟の車が馬）驫木
とやお	鳥（竹かんむりに弓）𥫤尾
とらわか	寅（若のくさかんむりが＋＋）
ながたに	（谷へんに龍）豅
にし	（にんべんのない価）
ぬでしま	（木へんに勝）橳島
ぬでじま	（木へんに勝）橳島
のぼり	（昇の升が舛）曻
はいしま	（くさかんむりに配）蓜島
はかた	（翅の支のないもの）羽片
はが	（土へんに並）𡌶
はぎ	（萩の秋が穐）蘒
はげやま	（山へんに玄）峐山
はれまき	晴（木へんに皮）柀
ひび	日（卉の十が立）竎
ひろさき	廣（山かんむりに奇）㟢
べんど	（木へんに黒）𣘸
べんどう	（木へんに黒）𣘸
ほうが	法（亠に儿）亢
ほうらい	蓬（くさかんむりに來）
ほうらい	蓬（莱の来が來）
ほきもと	（山の下に川）𡵅本
まさき	（眞のヒが十）﨑
ましも	（眞のヒが十）下
ますい	（土へんに曾）增位
まつい	（松のムが口）柗井
みすみ	三（角の田が甲）
もくめ	（木へんに也）杝
もつたて	持（舎へんに官）舘
もてぎ	（手へんに茂）𢰝木
やぎした	（木へんにタ卩）栁下
やなぎもと	（木へんに却の去がタ）栁本		※表記ゆれ。「やぎした	（木へんにタ卩）下」と同じか。
やなもと	（さんずい＋刃の下に木）梁本
やべ	谷（部のおおざとへんが邑）郶
やまわき	山（脇の力が刀）𦚰
よしおか	（日へんに童）岡
よしざわ	吉（白の下に大）㚖
よしだ	（日へんに童）田
らい	（頼の頁が刀の下に貝）賴
わけびき	釆（釋の釆なし）睪
```

　問題。「（木へんに青）」の漢字は「棈」の異体字らしい。だがこの字がUnicodeに存在しないのか見つからない。特に「あべまつ	（木へんに青）松」と「あべまつ	（木へんに青の月が円）松」が存在するのに、Unicode上では「棈」しかないせいで区別できない。そのままにしてある。同様に以下の漢字もなかった。

* （木へんに青）
* あめ	（餉の向が台）
* いしづき	（折の下に心）
* いづか	（土冠に猪）塚
* いのり	（祷の寿が壽）
* いれい	伊（ネへんに豊）
* いわす	（山かんむりに品）栖
* うかい	（鵜の弟が束）飼
* えきだ	（澤のさんずいが山）𡵸
* おおかんだ	大（神のネが示）田
* かくは	（角の田が甲）羽
* かげした	（陰の人の下が長）下
* くにぎだ	（木へんに解）
* くろはばき	黒（脛のエの下に巾）
* ざこうじ	（座の人が口と又）光寺
* ざま	（座の左の人が口）間
* しみず	（清の月が円）水
* じょうたつ	（丈｀）達
* すみ	（角の田が甲）
* すみの	（角の田が甲）野
* すみひろ	（角の田が甲）廣
* すみや	（角の田が甲）谷
* そにし	（口へんに曾）西
* たかまつ	髙（松のムが口）
* たかみざわ	（百貨店・高島屋の立）見澤
* ちかまつ	近（松のムが口）
* つのだ	（角の田が甲）田
* とらわか	寅（若のくさかんむりが＋＋）
* なかすみ	中（角の田が甲）
* にし	（にんべんのない価）
* ほうが	法（亠に儿）
* まさき	（眞のヒが十）﨑
* ましも	（眞のヒが十）下
* みすみ	三（角の田が甲）
* もつたて	持（舎へんに官）
* よしおか	（日へんに童）岡

　以下、ミス疑い。

* 「はれまき	晴まき」とあったが「はれまき	晴披」では？
* 「ほうらい	蓬（くさかんむりに來）」、「ほうらい	蓬（莱の来が來）」、「ほうらい	蓬莢」は同じでは？
* 「あさくろ	朝倉」は「あさくら	朝倉」だけでは？
* 「あみたに	真鍋」とあるが「まなべ	真鍋」では？
* 「あわごん	阿波根」とあるが「あはごん	阿波根」では？

　たとえば「あおさき」だと「青崎」「青﨑」「青嵜」の3つが出た。さらにそれぞれ読み方パターンがある。

```
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
8317	青崎		245	あおさき	あおざき				
41696	青﨑	%	15	あおさき	あおざき				
68900	青嵜		4	あおさき					
```
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
6793	青塚		337	あおつか	あおづか				
90200	青墳		1	あおつか☆					
90200	青冢		1	あおつか					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
398	青柳		12777	あおやぎ	あおやなぎ	あおぎ	あおなぎ☆		
11069	青栁	%	155	あおやぎ	あおやなぎ	あおぎ	あえやぎ		
81300	青やぎ		2	あおやぎ					
90200	靑柳	w+	1	あおやぎ					
90200	靑栁	w+	1	あおやぎ					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
2193	赤崎		1673	あかさき	あかざき	せきざき			
18115	赤﨑	%	69	あかさき	あかざき	せきざき			
19161	明崎	*	63	あけさき	あきざき☆	あけざき☆	あかさき☆		
33518	赤嵜		23	あかさき					
60450	赤碕		6	あかざき	あかさき☆				
60450	赤嵜g		6	あかさき				さ116	赤㟢g
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
1113	赤塚		3992	あかつか	あかづか	せきづか☆	あかずか☆		
4077	赤司		717	あかし	あかじ	あかつかさ			
43118	赤柄		14	あかつか					
90200	赤墳		1	あかつか☆					
90200	赤塚	w+	1	あかつか☆		塚に点あり			
90200	赤塚g		1	あかつか				外464b	
90200	赤塚g2	w+	1	あかつか				外4641L	
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
1341	秋吉		3138	あきよし	あきもと				
1823	日吉		2127	ひよし	あきよし	こよし			
5846	秋好		417	あきよし					
12126	穐吉		134	あきよし					
19180	龝吉		63	あきよし					
19690	明吉		60	あきよし	みよし	あけよし☆			
48150	秋芳		11	あきよし					
48151	秋由		11	あきよし					
64300	穐好		5	あきよし					
90200	了仍	+	1	あきよし☆					
90200	龝好		1	あきよし					
90200	秋吉g	+	1	あきよし				よ273	秋𠮷g
90200	穐吉g	w+	1	あきよし				よ2742	穐𠮷g
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
74500	あべ木	%	3	あべき					
74500	棈木	%	3	あべき					
90200	猜木g		1	あべき				外062	-
22103	棈木g		49	あべき	あべのき			外070	-
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
30084	精松		28	せいまつ	あべまつ☆				
33905	棈松	%	23	あべまつ					
38621	あべ松		17	あべまつ					
47375	安倍松		11	あべまつ					
49331	猜松		11	あべまつ					
55813	楕松		8	あべまつ					
57072	安部松		7	あべまつ					
81300	阿部松		2	あべまつ					
90200	アベ松	w+	1	あべまつ					
90200	猜松g	w+	1	あべまつ				外062b	
8616	棈松g		233	あべまつ				外070b	
90200	棈松g2	+	1	あべまつ★				外070c	
90200	棈松g		1	あべまつ				外659ba	
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
16269	天瀬		83	あませ					
43857	雨瀬		13	あめせ	あませ				
74500	天瀬川		3	あませがわ					
81300	天瀬田	~	2	あませた					
90200	阿万瀬		1	あませ☆					
90200	阿萬瀬	+	1	あませ☆					
90200	天懶	w+	1	あませ★					
90200	天瀨	w+	1	あませ				
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
28126	網崎		32	あみさき	あみざき				
81300	網﨑	~	2	あみさき	あみざき				
90200	網嵜		1	あみさき☆					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
3323	新崎	*	959	あらさき	あらざき				
11785	荒崎		140	あらさき					
35985	新﨑	%	20	あらさき	あらざき	しんさき☆	しんざき☆		
81300	荒﨑	~	2	あらさき					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
9341	安崎		203	あんざき	やすざき	やすさき☆			
39791	庵崎		16	あんさき	あんざき☆	いおさき☆	いおりざき☆	いおざき☆	
51702	安﨑	%	9	あんざき					
81300	庵﨑	%	2	あんざき					
90200	安嵜		1	あんざき☆					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
257	飯塚	*	21241	いいつか	いいづか	いづか	いいずか☆		
23093	飯束		45	いいずか	いいづか☆				
90200	井伊塚		1	いいずか					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
2573	池崎		1350	いけざき	いけさき				
14140	伊ケ崎		104	いかざき	いがさき	いけざき☆			
21269	池﨑	~	52	いけざき	いけさき				
25407	池嵜		38	いけざき					
42345	伊ヶ崎		14	いかざき	いがさき	いけざき☆			
90200	池埼		1	いけざき					
順位	苗字	**	世帯数	読み１　	読み２　	読み３　	読み４　	読み5、外字	読み6、UTFｺｰﾄﾞ
5149	石附	*	504	いしずき	いしづき	いしつき	いしつけ	いしずけ	
6566	石月		354	いしづき	いしつき	いしずき			
25367	石突		38	いしづき	いしずき☆				
58784	石築		7	いしちく	いしづき☆	いしずき☆			
60450	石槻		6	いしづき	いしつき☆				
81300	いしづき		2	いしづき					
90200	石附g		1	いしづき				外0091	-
81300	いしずきg		2	いしずき	いしづき			外142	鐏g


　別の読みバージョンも同様に追記すること。

Before
```
あおさき	青崎
...
あおざき	青崎
```
After
```
あおさき	青崎
あおさき	青﨑	
あおさき	青嵜
...
あおざき	青崎
あおざき	青﨑	
あおざき	青嵜
```

## 不具合修正2：DB正規化

* 異体字の名字が別の行で登録されている
* 異なる読みが登録されていない
* 異なる読みが別行で登録されている
* 異体字と異なる読みを含めて1行で登録するにはどのような形式で登録すべきか

　「異体字」と「異なる読みパターン」をどのように正規化すべきか。

A. 「漢字」と「読み」の組合せを１行とする（異体字、読み、で重複発生）
B. 「異体字」「異なる読みパターン」をそれぞれ個別マスタDBとして作成する
C. 「漢字」「読み」「異体字」「異なる読みパターン」をそれぞれ個別マスタDBとして作成する

　さらに「頻度（戸数）」もあればなお良し。

### A. 「漢字」と「読み」の組合せを１行とする

　漢字と読みの一方が違えば1レコードとなる。

項目|概要
----|----
特徴|重複レコードが多数出やすい
長所|新規追加しやすい。漢字と読みの組合せだけを登録すればいい。重複チェックも簡単なアルゴリズムで済む。
短所|ランダム出力アルゴリズムを単純化しづらい。たとえば1行選出するのに行数をランダム取得するとき、同じ漢字や読みの行が複数ある名字の場合は出現頻度が高まり不平等になる

```
あいかわ	相河
あいかわ	相川
```
```
たかはし	高橋
たかはし	髙橋
```
```
あかさき	赤﨑
あかさき	赤崎
あかさき	赤碕
あかざき	赤﨑
あかざき	赤崎
あかざき	赤碕
```

* 問題
	* 「異体字」とはどれか
		* `高`,`髙`
		* `川`,`河`
		* `崎`,`﨑`,`碕`
* 調査
	* [異体字](https://ja.wikipedia.org/wiki/%E5%AD%97%E4%BD%93)
		* [正字体](https://ja.wikipedia.org/wiki/%E5%AD%97%E4%BD%93#%E6%AD%A3%E5%AD%97%E4%BD%93)
			* [常用漢字](https://ja.wikipedia.org/wiki/%E5%B8%B8%E7%94%A8%E6%BC%A2%E5%AD%97)
			* [人名用漢字](https://ja.wikipedia.org/wiki/%E4%BA%BA%E5%90%8D%E7%94%A8%E6%BC%A2%E5%AD%97)
				* [人名用漢字一覧](https://ja.wikipedia.org/wiki/%E4%BA%BA%E5%90%8D%E7%94%A8%E6%BC%A2%E5%AD%97%E4%B8%80%E8%A6%A7)
				* [人名用漢字一覧表](https://kanji.jitenon.jp/cat/jimmei.html)
				* [人名に使える漢字一覧表](http://www13.plala.or.jp/bigdata/jinmei_kanji.html)
					* 「名前」として使える漢字は3101字(漢字2999(常用(2136)＋人名用(863))＋ひらがな・カタカナ・長音・繰り返し記号(102))
					* 「名字・姓・苗字・家名・氏」には制約がない
				* 人名に使える漢字以外(102字)
					* ひらがな（あ〜わ、を、ん）：46種類
					* ひらがな（旧字：ゐ、ゑ）：2種類
					* ひらがな（繰返し：ゝ、ゞ）：2種類
					* カタカナ（ア〜ワ、ヲ、ン）：46種類
					* カタカナ（旧字：ヰ、ヱ）：2種類
					* カタカナ（繰返し：ヽ、ヾ）：2種類
					* 長音記号（ー）：1種類
					* 繰返し記号（々）：1種類
				* [氏・姓・苗字・家名・名字](http://www.harimaya.com/o_kamon1/seisi/sei_uda.html)
					* 時代の社会や政治を反映している
						* 氏: 同じ祖先をもつ家族の集団
						* 姓: 氏に付いてその職掌・家格や尊卑を表わす呼称
						* 苗字/名字: 発生的には、名字が先。
							* 名字: 荘園制度によって土地を所有した名主は所有地の字名(azana)を家名とする風習。
							* 苗字: 平安時代になって子孫が繁栄することを期待して、吉祥を意味する文字を選んで家名とする風習。
			* 古字（古文）: 「一」に対する「弌」、「協」に対する「叶」など。
			* 俗字・通字: 正字として認められた字体以外で通用されている文字。
				* 俗字:
					* 別の部品を当てるもの
					* 同じ音をもつ部品を当てるもの
					* 画数を減らすもの
					* 別の部品を付け足すもの
					* 異なる発想で会意字を作るものなど
					* 例
						* 「卒」に対する「卆」
						* 「崎」に対する「﨑」（あるいは「嵜」「㟢」（山冠に奇））
						* 「富」に対する「冨」
						* 「場」に対する「塲」
						* 「淵」に対する「渕」（あるいは「渊」）
						* 「哲」に対する「喆」、「高」に対する「髙」
						* 「橋」に対する「槗」「𣘺」
						* 「魚」に対する「𩵋」（「魚」の下の部分が「れんが（灬）」ではなく「大」）
						* 「解」に対する「觧」
						* 「翠」に対する「翆」など
				* 異体字
					* 同じ構成要素をもつが、その配置が異なるもの
						* 隣 - 鄰
						* 和 - 咊
						* 飄 - 飃
						* 峰 - 峯
						* 㟁 - 岸
						* 群 - 羣
						* 鵝 - 鵞
						* 鑑 - 鑒
						* 慚 - 慙
						* 晰 - 晳
						* 稿 - 稾
						* 雜 - 襍
						* 裏 - 裡
						* 松 - 枩
						* 島 - 嶋 - 嶌
					* 異なる音符を使ったもの
						* 棲 - 栖
						* 綫 - 線
						* 麪 - 麵
						* 卻 - 却
						* 筍 - 笋
						* 窯 - 窰
						* 嶋 - 嶹
						* 鐵 - 鉄（鉃は別字）
					* 異なる意符を用いたもの
						* 効 - 效
						* 秘 - 祕
						* 嘆 - 歎
						* 睹 - 覩
						* 暖 - 煖
						* 器 - 噐
						* 収 - 收
						* 詠 - 咏
						* 唇 - 脣
						* 罰 - 罸
						* 考 - 攷
						* 恥 - 耻
						* 埆 - 确
						* 翻 - 飜
					* 一方が形声で作られ、一方が会意で作られたもの
						* 涙 - 泪
						* 巌 - 岩
						* 渺 - 淼
						* 拏 - 拿
						* 逃 - 迯
						* 葉 - 叶
						* 傑 - 杰
						* 輭 - 軟
					* 会意や形声の仕方が異なり、字体上の共通項もないもの
						* 體 - 体
						* 同 - 仝
						* 村 - 邨
					* 略体・書き癖・運筆の連綿などによって生じたもの（竹冠と草冠、「口」と「ム」、「TRON 3-EC6A.gif」と「TRON 3-EC69.gif」などは相互置換される例が特に多い）
						* 莚 - 筵
						* 船 - 舩
						* 曾 - 曽　　　
						* 鰺 - 鯵
						* 龍 - 竜
						* 點 - 点
						* 蠶 - 蚕
						* 晝 - 昼
						* 畫 - 画
						* 讀 - 読
						* 戀 - 恋
						* 傳 - 伝

### B. 「異体字」、「異なる読みパターン」をそれぞれ個別マスタDBとして作成する

漢字.tsv
```
赤崎
```

異体字.tsv
```
赤崎,赤﨑,赤碕
あかさき	赤﨑
あかさき	赤碕
あかざき	赤﨑
あかざき	
あかざき	赤碕
```

読み.tsv
```
赤崎,あかさき,あかざき
```

### C. 「漢字」「読み」「異体字」「異なる読みパターン」をそれぞれ個別マスタDBとして作成する

正字体.tsv
```
赤崎
```

読み.tsv
```
あかさき
あかざき
せきさき
せきざき
```

異体字.tsv
```
赤崎,赤﨑,赤碕
```

読み.tsv
```
赤崎,あかさき,あかざき,せきさき,せきざき
```

読み.tsv
```
あかさき,赤崎,赤﨑,赤碕
あかざき,赤崎,赤﨑,赤碕
せきさき,赤崎,赤﨑,赤碕
せきざき,赤崎,赤﨑,赤碕
```
```
あかさき,赤崎
あかざき,赤崎
せきさき,赤崎
せきざき,赤崎
```
```
赤崎,あかさき,あかざき,せきさき,せきざき
赤﨑,あかさき,あかざき,せきさき,せきざき
赤碕,あかさき,あかざき,せきさき,せきざき
```

　重複せずデータ量を減らした正規化パターンは以下か。

正字体.tsv
```
赤崎
```
異体字.tsv
```
赤崎,赤﨑,赤碕
```
読み.tsv
```
赤崎,あかさき,あかざき,せきさき,せきざき
```

　さらに上記を1行で表すと以下。`,`で表記と読みを分岐し、`;`でそれぞれの異なるパターンを網羅。順序は優先度。一番目が正字体・代表読み。

表記＆読み.tsv
```
赤崎;赤﨑;赤碕,あかさき;あかざき;せきさき;せきざき
```

項目|概要
----|----
長所|少容量。ランダム選出アルゴリズムを単純化できる。
短所|`,`,`;`分解アルゴリズム必須。異体字でないが同音の場合は別レコードであるため同音異字を除外するときのアルゴリズム必須

　厳しく正規化するなら以下の工夫もできるか？

* `崎`の異体字として`﨑`,`碕`を登録しパターン化する方法もある
* `崎`の読みを`さき`とし、濁点付与パターンとして`ざき`を追加する
	* ただし2字以上で特殊な読み方になるパターンもある

　テーブルは「正規化」と「結合化」の2状態に大別できる。

状態|概要|長所|短所
----|----|----|----
正規化|重複しない一意データ|軽量|難結合
結合化|部分重複する|即結合|重量

　「正規化」は重複データがない。容量が少なく済む。ただし結合しないと最終成果物にならない上、結合処理が大変。

　「結合化」は最終成果物の形でそのまま保存する。部分重複が膨大にあるため容量が多い。ただし結合処理が不要なため高速。

　正規化を考えると面倒。もう全パターン「結合化」したテキストを用意したほうが楽か？　重複排除についてはランダム選出したあとでチェックし、重複していたら再実行するようにしちゃえばいい。

# 対象環境

* <time datetime="2020-08-29T14:39:34+0900" title="実施日">2020-08-29</time>

